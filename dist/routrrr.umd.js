/*!
 * routrrr - version 0.6.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2023 Steve Ottoz
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Routrrr=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t){var e=this;return new Promise((function(r,n){var o=[];e.mw.forEach((function(r){o.push(r.call(e,t))})),Promise.all(o).then(r).catch(n)}))}function h(t){var e={};if(!(t=location.search.replace("?","")))return e;var r,n=/\[\]$/,o=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=s(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}(t.split("&"));try{for(o.s();!(r=o.n()).done;){var a=r.value,i=u(decodeURIComponent(a).split("="),2),l=i[0],f=i[1];f=void 0===f||f,n.test(l)?(l=l.replace(n,""),Array.isArray(e[l])||(e[l]=[]),e[l]=[].concat(c(e[l]),[f])):e[l]=f}}catch(t){o.e(t)}finally{o.f()}return e}return function(t){if(!t&&!t.pushState)return!1;var e=t.pushState,r=t.replaceState;function n(t,e){var r=document.createEvent("CustomEvent");r.initCustomEvent(t+"state",!0,!0,e),window.dispatchEvent(r)}t.pushState=function(r,o){var a=e.apply(t,arguments);return o&&(document.title=o),n("push",r),a},t.replaceState=function(e,o){var a=r.apply(t,arguments);return o&&(document.title=o),n("replace",e),a}}(window.history),function(){function o(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#!";r(this,o),this.support=history&&history.pushState,this.routes=[],this.mw=[],this.currentPath="",this.currentHash="",this.useHash=e,this.hashPrefix=n,["popstate","pushstate","replacestate"].forEach((function(e){window.addEventListener(e,(function(e){if(!t.useHash&&t.currentPath===e.target.location.pathname&&t.currentPath!==e.target.location.hash&&e.target.location.hash)return e.preventDefault(),!1;t.load()}))}))}var a,u,c,s,l;return a=o,(u=[{key:"get",value:function(t,e,r){var n={path:t,mw:r?e:null,fn:r||e,keys:[],params:{}};return n.regex=function(t,e,r,n){return t instanceof RegExp?t:(t instanceof Array&&(t="("+t.join("|")+")"),t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(t,r,n,o,a,i){return e.push({name:o,optional:!!i}),r=r||"",(i?"":r)+"(?:"+(i?r:"")+(n||"")+(a||n&&"([^/.]+?)"||"([^/]+?)")+")"+(i||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",r?"":"i"))}(n.path,n.keys,!1,!1),this.routes.push(n),this}},{key:"use",value:function(e){return/^f/.test(t(e))&&this.mw.indexOf(e)<0&&this.mw.push(e),this}},{key:"redirect",value:function(t,e){return this.useHash?window.location.hash=this.hashPrefix+t:this.support?(e?history.replaceState:history.pushState)({url:t,date:new Date},null,t):window.location.href=t,this}},{key:"push",value:function(t){return this.redirect(t,!1)}},{key:"replace",value:function(t){return this.redirect(t,!0)}},{key:"load",value:(s=regeneratorRuntime.mark((function t(e){var r,n,o,a,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.useHash?location.hash.replace(hashPrefix,""):(e&&e.url?e.url:window.location.pathname).split("?")[0],n={},o=i(i({},location),{},{params:n,pathname:r,query:h()}),this.routes.forEach((function(t){a||(u=r.match(t.regex))&&(a=t)})),!a){t.next=23;break}return u&&u.shift(),u.forEach((function(t,e){n[a.keys[e].name]=t})),o=i(i({},o),{},{route:a.path,params:n}),t.prev=8,t.next=11,f.call(this,o);case 11:if(!a.mw){t.next=16;break}return t.next=14,a.mw.call(this,o).catch((function(t){}));case 14:t.next=17;break;case 16:a.fn.call(this,o);case 17:t.next=21;break;case 19:t.prev=19,t.t0=t.catch(8);case 21:t.next=32;break;case 23:return t.prev=23,t.next=26,f.call(this,o);case 26:o=i(i({},o),{},{route:null}),this.default&&this.default.call(this,o),t.next=32;break;case 30:t.prev=30,t.t1=t.catch(23);case 32:return this.currentPath=r,this.currentHash=location.hash,t.abrupt("return",this);case 35:case"end":return t.stop()}}),t,this,[[8,19],[23,30]])})),l=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=s.apply(t,r);function i(t){e(a,n,o,i,u,"next",t)}function u(t){e(a,n,o,i,u,"throw",t)}i(void 0)}))},function(t){return l.apply(this,arguments)})},{key:"init",value:function(){return this.load()}},{key:"setDefault",value:function(e){return/^f/.test(t(e))&&(this.default=e),this}}])&&n(a.prototype,u),c&&n(a,c),o}()}));
