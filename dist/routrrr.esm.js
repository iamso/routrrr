/*!
 * routrrr - version 0.5.0
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2022 Steve Ottoz
 */
!function(t){if(!t&&!t.pushState)return!1;const e=t.pushState,a=t.replaceState;function s(t,e){const a=document.createEvent("CustomEvent");a.initCustomEvent(t+"state",!0,!0,e),window.dispatchEvent(a)}t.pushState=function(a,r){let i=e.apply(t,arguments);return r&&(document.title=r),s("push",a),i},t.replaceState=function(e,r){let i=a.apply(t,arguments);return r&&(document.title=r),s("replace",e),i}}(window.history);function t(t){return new Promise(((e,a)=>{const s=[];this.mw.forEach((e=>{s.push(e.call(this,t))})),Promise.all(s).then(e).catch(a)}))}function e(t){if(!(t=location.search.replace("?","")))return;const e=t.split("&"),a={},s=/\[\]$/;for(let t of e){let[e,r]=decodeURIComponent(t).split("=");r=r?r.split("+").join(" "):"",s.test(e)?(e=e.replace(s,""),Array.isArray(a[e])||(a[e]=[]),a[e]=[...a[e],r]):a[e]=r}return a}export default class{constructor(t=!1,e="#!"){this.support=history&&history.pushState,this.routes=[],this.mw=[],this.currentPath="",this.currentHash="",this.useHash=t,this.hashPrefix=e,["popstate","pushstate","replacestate"].forEach((t=>{window.addEventListener(t,(t=>{if(!this.useHash&&this.currentPath===t.target.location.pathname&&this.currentPath!==t.target.location.hash&&t.target.location.hash)return t.preventDefault(),!1;this.load()}))}))}get(t,e,a){const s={path:t,mw:a?e:null,fn:a||e,keys:[],params:{}};return s.regex=function(t,e,a,s){if(t instanceof RegExp)return t;t instanceof Array&&(t="("+t.join("|")+")");return t=t.concat(s?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(t,a,s,r,i,h){return e.push({name:r,optional:!!h}),a=a||"",(h?"":a)+"(?:"+(h?a:"")+(s||"")+(i||s&&"([^/.]+?)"||"([^/]+?)")+")"+(h||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",a?"":"i")}(s.path,s.keys,!1,!1),this.routes.push(s),this}use(t){return/^f/.test(typeof t)&&this.mw.indexOf(t)<0&&this.mw.push(t),this}redirect(t,e){return this.useHash?window.location.hash=this.hashPrefix+t:this.support?(e?history.replaceState:history.pushState)({url:t,date:new Date},null,t):window.location.href=t,this}async load(a){const s=this.useHash?location.hash.replace(hashPrefix,""):(a&&a.url?a.url:window.location.pathname).split("?")[0],r={};let i,h,n={...location,params:r,pathname:s,query:e()};if(this.routes.forEach((t=>{i||(h=s.match(t.regex))&&(i=t)})),i){h&&h.shift(),h.forEach(((t,e)=>{r[i.keys[e].name]=t})),n={...n,route:i.path,params:r};try{await t.call(this,n),i.mw?await i.mw.call(this,n).catch((t=>{})):i.fn.call(this,n)}catch(t){}}else try{await t.call(this,n),n={...n,route:null},this.default&&this.default.call(this,n)}catch(t){}return this.currentPath=s,this.currentHash=location.hash,this}init(){return this.load()}setDefault(t){return/^f/.test(typeof t)&&(this.default=t),this}}
