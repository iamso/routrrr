/*!
 * routrrr - version 0.1.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2016 Steve Ottoz
 */
(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports'],b);else if('undefined'!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.Routrrr=c.exports}})(this,function(a,b){'use strict';function c(n){if(Array.isArray(n)){for(var o=0,p=Array(n.length);o<n.length;o++)p[o]=n[o];return p}return Array.from(n)}function d(n,o){if(!(n instanceof o))throw new TypeError('Cannot call a class as a function')}function f(n){var o=this;return new Promise(function(p,q){var s=[];o.mw.forEach(function(t){s.push(t.apply(o,[n]))}),Promise.all(s).then(p).catch(q)})}function g(n,o,p,q){return n instanceof RegExp?n:(n instanceof Array&&(n='('+n.join('|')+')'),n=n.concat(q?'':'/?').replace(/\/\(/g,'(?:/').replace(/\+/g,'__plus__').replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(s,t,u,v,w,x){return o.push({name:v,optional:!!x}),t=t,''+(x?'':t)+'(?:'+(x?t:'')+u+(w||u&&'([^/.]+?)'||'([^/]+?)')+')'+x}).replace(/([\/.])/g,'\\$1').replace(/__plus__/g,'(.+)').replace(/\*/g,'(.*)'),new RegExp('^'+n+'$',p?'':'i'))}function h(n){if(n=location.search.replace('?','')){var o=n.split('&'),p={},q=/\[\]$/,s=!0,t=!1,u=void 0;try{for(var w,v=o[Symbol.iterator]();!(s=(w=v.next()).done);s=!0){var x=w.value,y=decodeURIComponent(x).split('='),z=j(y,2),A=z[0],B=z[1];B=B?B.split('+').join(' '):'',q.test(A)?(A=A.replace(q,''),!Array.isArray(p[A])&&(p[A]=[]),p[A]=[].concat(c(p[A]),[B])):p[A]=B}}catch(C){t=!0,u=C}finally{try{!s&&v.return&&v.return()}finally{if(t)throw u}}return p}}Object.defineProperty(b,'__esModule',{value:!0});var j=function(){function n(o,p){var q=[],s=!0,t=!1,u=void 0;try{for(var w,v=o[Symbol.iterator]();!(s=(w=v.next()).done)&&(q.push(w.value),!(p&&q.length===p));s=!0);}catch(x){t=!0,u=x}finally{try{!s&&v['return']&&v['return']()}finally{if(t)throw u}}return q}return function(o,p){if(Array.isArray(o))return o;if(Symbol.iterator in Object(o))return n(o,p);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),k='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&'function'==typeof Symbol&&n.constructor===Symbol?'symbol':typeof n},l=function(){function n(o,p){for(var q=0;q<p.length;q++){var s=p[q];s.enumerable=s.enumerable,s.configurable=!0,'value'in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}return function(o,p,q){return p&&n(o.prototype,p),q&&n(o,q),o}}(),m=function(){function n(){var o=this,p=0>=arguments.length||void 0===arguments[0]?!1:arguments[0],q=1>=arguments.length||void 0===arguments[1]?'#!':arguments[1];d(this,n),this.support=history&&history.pushState,this.routes=[],this.mw=[],this.currentPath='',this.currentHash='',this.useHash=p,this.hashPrefix=q,['popstate','pushstate','replacestate'].forEach(function(s){window.addEventListener(s,function(t){return!o.useHash&&o.currentPath===t.target.location.pathname&&o.currentPath!==t.target.location.hash&&t.target.location.hash?(t.preventDefault(),!1):void o.load()})})}return l(n,[{key:'get',value:function(p,q,s){var t={path:p,mw:s?q:null,fn:s||q,keys:[],params:{}};return t.regex=g(t.path,t.keys,!1,!1),this.routes.push(t),this}},{key:'use',value:function(p){return /^f/.test('undefined'==typeof p?'undefined':k(p))&&0>this.mw.indexOf(p)&&this.mw.push(p),this}},{key:'redirect',value:function(p,q){return this.useHash?window.location.hash=this.hashPrefix+p:this.support?(q?history.replaceState:history.pushState)({url:p,date:new Date},null,p):window.location.href=p,this}},{key:'load',value:function(p){var q=this,s=this.useHash?location.hash.replace(hashPrefix,''):(p&&p.url?p.url:window.location.pathname).split('?')[0],t={},u=Object.assign({},location,{params:t,pathname:s,query:h()}),v=void 0,w=void 0;return this.routes.forEach(function(x){!v&&(w=s.match(x.regex))&&(v=x)}),v?(w&&w.shift(),w.forEach(function(x,y){t[v.keys[y].name]=x}),Object.assign(u,{route:v.path,params:t}),f.call(this,u).then(function(){v.mw?v.mw.apply(q,[u]).then(function(){v.fn.apply(q,[u])}).catch(function(x){}):v.fn.apply(q,[u])}).catch(function(x){})):f.call(this,u).then(function(){Object.assign(u,{route:null}),q.default&&q.default.apply(q,[u])}).catch(function(x){}),this.currentPath=s,this.currentHash=location.hash,this}},{key:'setDefault',value:function(p){return /^f/.test('undefined'==typeof p?'undefined':k(p))&&(this.default=p),this}}]),n}();b.default=m;;(function(n){'use strict';function o(s,t){var u=document.createEvent('CustomEvent');u.initCustomEvent(s+'state',!0,!0,t),window.dispatchEvent(u)}if(!n&&!n.pushState)return!1;var p=n.pushState,q=n.replaceState;n.pushState=function(s,t){var u=p.apply(n,arguments);return t&&(document.title=t),o('push',s),u},n.replaceState=function(s,t){var u=q.apply(n,arguments);return t&&(document.title=t),o('replace',s),u}})(window.history),a.exports=b['default']});