/*!
 * routrrr - version 0.7.0
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2025 Steve Ottoz
 */
"use strict";!function(t){if(!t&&!t.pushState)return!1;const e=t.pushState,s=t.replaceState;function a(t,e){const s=new CustomEvent(t+"state",{detail:e});window.dispatchEvent(s)}t.pushState=function(s,r){let i=e.apply(t,arguments);return r&&(document.title=r),a("push",s),i},t.replaceState=function(e,r){let i=s.apply(t,arguments);return r&&(document.title=r),a("replace",e),i}}(window.history);function t(t){return new Promise(((e,s)=>{const a=[];this.mw.forEach((e=>{a.push(e.call(this,t))})),Promise.all(a).then(e).catch(s)}))}function e(t){const e={};if(!(t=location.search.replace("?","")))return e;const s=t.split("&"),a=/\[\]$/;for(const t of s){let[s,r]=decodeURIComponent(t).split("=");r=void 0===r||r,a.test(s)?(s=s.replace(a,""),Array.isArray(e[s])||(e[s]=[]),e[s]=[...e[s],r]):e[s]=r}return e}module.exports=class{constructor(t=!1,e="#!"){this.support=history&&history.pushState,this.routes=[],this.mw=[],this.currentPath="",this.currentHash="",this.useHash=t,this.hashPrefix=e,["popstate","pushstate","replacestate"].forEach((t=>{window.addEventListener(t,(t=>{if(!this.useHash&&this.currentPath===t.target.location.pathname&&this.currentPath!==t.target.location.hash&&t.target.location.hash)return t.preventDefault(),!1;this.load()}))}))}get(t,e,s){const a={path:t,mw:s?e:null,fn:s||e,keys:[],params:{}};return a.regex=function(t,e,s,a){if(t instanceof RegExp)return t;t instanceof Array&&(t="("+t.join("|")+")");return t=t.concat(a?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(t,s,a,r,i,h){return e.push({name:r,optional:!!h}),s=s||"",(h?"":s)+"(?:"+(h?s:"")+(a||"")+(i||a&&"([^/.]+?)"||"([^/]+?)")+")"+(h||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",s?"":"i")}(a.path,a.keys,!1,!1),this.routes.push(a),this}use(t){return/^f/.test(typeof t)&&this.mw.indexOf(t)<0&&this.mw.push(t),this}redirect(t,e){return this.useHash?window.location.hash=this.hashPrefix+t:this.support?(e?history.replaceState:history.pushState)({url:t,date:new Date},null,t):window.location.href=t,this}push(t){return this.redirect(t,!1)}replace(t){return this.redirect(t,!0)}async load(s){const a=this.useHash?location.hash.replace(hashPrefix,""):(s&&s.url?s.url:window.location.pathname).split("?")[0],r={};let i,h,n={...location,params:r,pathname:a,query:e()};if(this.routes.forEach((t=>{i||(h=a.match(t.regex))&&(i=t)})),i){h&&h.shift(),h.forEach(((t,e)=>{r[i.keys[e].name]=t})),n={...n,route:i.path,params:r};try{await t.call(this,n),i.mw?await i.mw.call(this,n).catch((t=>{})):i.fn.call(this,n)}catch(t){}}else try{await t.call(this,n),n={...n,route:null},this.default&&this.default.call(this,n)}catch(t){}return this.currentPath=a,this.currentHash=location.hash,this}init(){return this.load()}setDefault(t){return/^f/.test(typeof t)&&(this.default=t),this}};
